<!DOCTYPE html>
<html>
  <head>
    <!-- meta information -->
<meta charset="utf-8">
<meta name="description" 
      content="Welcome to the `elastic` screencast!Follow along below in your favorite R client.elastic screencast==========## Intro..." >
<meta name="author" content="Scott Chamberlain">

<!-- Enable responsiveness on mobile devices-->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<!-- title -->
<title>elastic &middot; rOpenSci</title>

<!-- icons -->
<link rel="shortcut icon" href="/screencasts/public/images/ropensci_favicon.ico" />

<!-- stylesheets -->
<link rel="stylesheet" href="/screencasts/public/css/responsive.gs.12col.css">
<link rel="stylesheet" href="/screencasts/public/css/animate.min.css">
<link rel="stylesheet" href="/screencasts/public/css/main.css">

<!-- Google fonts -->
<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic&subset=latin-ext">



<!-- feed links -->
<link rel="alternate" href="http://ropensci.github.io/screencasts/feed.xml" type="application/rss+xml" title="">

  </head>
  <body>
    <div class="container azul">
      <header class="top row gutters">
        <div class="col span_2 center">
          <!-- TODO: add baseurl to the logo link -->
          <a href="http://ropensci.github.io/screencasts" id="logo" title="rOpenSci"
             style="background-image: url(/screencasts/public/images/ropensci_small.png);"></a>
        </div>
        <nav class="col span_10 top-navbar">
  
  <a href="/screencasts/" title="Home"
     >Home</a>
  
  <a href="/screencasts/about/" title="About"
     >About</a>
  
</nav>

      </header>

      <article class="single row gutters">
  <!-- <time class="published" datetime="2015-04-13">13 April 2015</time> -->
  <h2>elastic</h2>

  <p>Welcome to the <code>elastic</code> screencast!</p>

<p>Follow along below in your favorite R client.</p>

<!-- iframe when ready -->

<h1>elastic screencast</h1>

<h2>Intro</h2>

<blockquote>
<p>Hi, I&#39;m Scott Chamberlain</p>

<p>In this screencast, I&#39;ll do a brief intoduction to the <code>elastic</code> package - an <code>R</code> client for <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a></p>

<p>You can install elastic from <a href="http://cran.rstudio.com/web/packages/elastic">CRAN</a>, or install the <a href="https://github.com/ropensci/elastic">development version from GitHub</a>.</p>

<p><code>elastic</code> allows you to interact with any Elasticsearch installation</p>

<p>Elasticsearch is a powerful database, with a built in HTTP API for easy integration, like 
in this package, a powerful query engine, and easy data input b/c you don&#39;t have to 
specify a schema manaully beforehand</p>

<p>I&#39;ll walk you through a variety of things you can do with elastic</p>
</blockquote>

<h2>Installation and load</h2>
<div class="highlight"><pre><code class="language-r" data-lang="r">install.packages<span class="p">(</span><span class="s">&quot;elastic&quot;</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r"><span class="kn">library</span><span class="p">(</span><span class="s">&quot;elastic&quot;</span><span class="p">)</span>
</code></pre></div>
<h2>Install and start Elasticsearch</h2>

<ul>
<li><a href="http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/_installation.html">Elasticsearch installation help</a></li>
<li>Navigate to elasticsearch: <code>cd /usr/local/elasticsearch</code></li>
<li>Start elasticsearch: <code>bin/elasticsearch</code></li>
</ul>

<h2>Initialize connection</h2>

<blockquote>
<p><code>connect()</code> is used before doing anything else to set the connection details to your remote or local elasticsearch store</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">connect<span class="p">()</span>
<span class="c1">#&gt; uri:       http://127.0.0.1 </span>
<span class="c1">#&gt; port:      9200 </span>
<span class="c1">#&gt; username:  NULL </span>
<span class="c1">#&gt; password:  NULL </span>
<span class="c1">#&gt; elasticsearch details:   </span>
<span class="c1">#&gt;       status:                  200 </span>
<span class="c1">#&gt;       name:                    Constrictor </span>
<span class="c1">#&gt;       Elasticsearch version:   1.5.0 </span>
<span class="c1">#&gt;       ES version timestamp:    2015-03-23T14:30:58Z </span>
<span class="c1">#&gt;       lucene version:          4.10.4</span>
</code></pre></div>
<blockquote>
<p>On package load, base url and port set to <code>http://127.0.0.1</code> and <code>9200</code></p>
</blockquote>

<h2>Elasticsearch management</h2>

<h3>Cat</h3>

<blockquote>
<p>Get list of cat endpoints</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">cat_<span class="p">()</span>
<span class="c1">#&gt; =^.^=</span>
<span class="c1">#&gt; /_cat/allocation</span>
<span class="c1">#&gt; /_cat/shards</span>
<span class="c1">#&gt; /_cat/shards/{index}</span>
<span class="c1">#&gt; /_cat/master</span>
<span class="c1">#&gt; /_cat/nodes</span>
<span class="c1">#&gt; /_cat/indices</span>
<span class="c1">#&gt; /_cat/indices/{index}</span>
<span class="c1">#&gt; /_cat/segments</span>
<span class="c1">#&gt; /_cat/segments/{index}</span>
<span class="c1">#&gt; /_cat/count</span>
<span class="c1">#&gt; /_cat/count/{index}</span>
<span class="c1">#&gt; /_cat/recovery</span>
<span class="c1">#&gt; /_cat/recovery/{index}</span>
<span class="c1">#&gt; /_cat/health</span>
<span class="c1">#&gt; /_cat/pending_tasks</span>
<span class="c1">#&gt; /_cat/aliases</span>
<span class="c1">#&gt; /_cat/aliases/{alias}</span>
<span class="c1">#&gt; /_cat/thread_pool</span>
<span class="c1">#&gt; /_cat/plugins</span>
<span class="c1">#&gt; /_cat/fielddata</span>
<span class="c1">#&gt; /_cat/fielddata/{fields}</span>
</code></pre></div>
<blockquote>
<p>E.g., Get list of indices</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">cat_indices<span class="p">()</span>
<span class="c1">#&gt; yellow open stuff               5 1       0     0     575b     575b </span>
<span class="c1">#&gt; yellow open geonames            5 1 6646030 20005    1.9gb    1.9gb </span>
<span class="c1">#&gt; yellow open gbif                5 1     899     0      1mb      1mb </span>
<span class="c1">#&gt; yellow open mtcars              5 1      32     0   36.7kb   36.7kb </span>
<span class="c1">#&gt; yellow open twitter             5 1       0     0     575b     575b </span>
<span class="c1">#&gt; yellow open iris                5 1     150     0   43.4kb   43.4kb </span>
<span class="c1">#&gt; yellow open things2             5 1       0     0     575b     575b </span>
<span class="c1">#&gt; yellow open gbifgeopoint        5 1     600     0  953.5kb  953.5kb </span>
<span class="c1">#&gt; yellow open gbifnewgeo          5 1       2     0    5.8kb    5.8kb </span>
<span class="c1">#&gt; yellow open logstash-2018.02.28 5 1       0     0     575b     575b </span>
<span class="c1">#&gt; yellow open plos                5 1    1000     0  414.6kb  414.6kb </span>
<span class="c1">#&gt; yellow open shakespeare         5 1    5000     0 1023.2kb 1023.2kb </span>
<span class="c1">#&gt; yellow open hello               5 1       0     0     575b     575b </span>
<span class="c1">#&gt; yellow open animals             5 1       2     0    3.1kb    3.1kb </span>
<span class="c1">#&gt; yellow open shakespeare2        5 1       0     0     575b     575b </span>
<span class="c1">#&gt; yellow open gbifgeo             5 1     600     0  861.9kb  861.9kb </span>
<span class="c1">#&gt; yellow open diamonds_small      5 1    1000     0  209.2kb  209.2kb </span>
<span class="c1">#&gt; yellow open geoshape            5 1     222     0   42.9kb   42.9kb </span>
<span class="c1">#&gt; yellow open things              5 1       0     0     575b     575b</span>
</code></pre></div>
<h3>Cluster info</h3>

<blockquote>
<p>Get list of cat endpoints</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">cluster_health<span class="p">()</span>
<span class="c1">#&gt; $cluster_name</span>
<span class="c1">#&gt; [1] &quot;elasticsearch&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $status</span>
<span class="c1">#&gt; [1] &quot;yellow&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $timed_out</span>
<span class="c1">#&gt; [1] FALSE</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $number_of_nodes</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $number_of_data_nodes</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $active_primary_shards</span>
<span class="c1">#&gt; [1] 95</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $active_shards</span>
<span class="c1">#&gt; [1] 95</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $relocating_shards</span>
<span class="c1">#&gt; [1] 0</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $initializing_shards</span>
<span class="c1">#&gt; [1] 0</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $unassigned_shards</span>
<span class="c1">#&gt; [1] 95</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $number_of_pending_tasks</span>
<span class="c1">#&gt; [1] 0</span>
</code></pre></div>
<h3>Node info</h3>

<blockquote>
<p>E.g., Get list of indices</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">nodes_info<span class="p">()</span>
</code></pre></div>
<h3>Node info</h3>

<blockquote>
<p>E.g., Get list of indices</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">nodes_info<span class="p">()</span>
</code></pre></div>
<h2>Indices</h2>

<ul>
<li><code>index_create()</code></li>
<li><code>index_delete()</code></li>
<li><code>index_exists()</code></li>
<li><code>index_get()</code></li>
<li><code>index_settings()</code></li>
<li><code>index_stats()</code></li>
<li><code>index_status()</code></li>
<li>...</li>
</ul>

<blockquote>
<p>Create an index</p>
</blockquote>
<div class="highlight"><pre><code class="language-text" data-lang="text">#&gt; $acknowledged
#&gt; [1] TRUE
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r">index_create<span class="p">(</span><span class="s">&quot;animals&quot;</span><span class="p">)</span>
<span class="c1">#&gt; $acknowledged</span>
<span class="c1">#&gt; [1] TRUE</span>
</code></pre></div><div class="highlight"><pre><code class="language-r" data-lang="r">index_get<span class="p">(</span><span class="s">&quot;animals&quot;</span><span class="p">)</span>
<span class="c1">#&gt; $animals</span>
<span class="c1">#&gt; $animals$aliases</span>
<span class="c1">#&gt; named list()</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $animals$mappings</span>
<span class="c1">#&gt; named list()</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $animals$settings</span>
<span class="c1">#&gt; $animals$settings$index</span>
<span class="c1">#&gt; $animals$settings$index$creation_date</span>
<span class="c1">#&gt; [1] &quot;1427935044323&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $animals$settings$index$number_of_shards</span>
<span class="c1">#&gt; [1] &quot;5&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $animals$settings$index$number_of_replicas</span>
<span class="c1">#&gt; [1] &quot;1&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $animals$settings$index$version</span>
<span class="c1">#&gt; $animals$settings$index$version$created</span>
<span class="c1">#&gt; [1] &quot;1050099&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $animals$settings$index$uuid</span>
<span class="c1">#&gt; [1] &quot;cWcS47e2SiS5aeK6ydVAgQ&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $animals$warmers</span>
<span class="c1">#&gt; named list()</span>
</code></pre></div>
<h2>Documents</h2>

<ul>
<li><code>docs_create()</code></li>
<li><code>docs_get()</code></li>
<li><code>docs_mget()</code></li>
<li><code>docs_delete()</code></li>
<li><code>docs_bulk()</code></li>
</ul>

<blockquote>
<p>Create a few documents</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">docs_create<span class="p">(</span>index<span class="o">=</span><span class="s">&#39;animals&#39;</span><span class="p">,</span> type<span class="o">=</span><span class="s">&#39;bears&#39;</span><span class="p">,</span> id<span class="o">=</span><span class="m">1</span><span class="p">,</span> body<span class="o">=</span><span class="kt">list</span><span class="p">(</span>id<span class="o">=</span><span class="s">&quot;12345&quot;</span><span class="p">,</span> name<span class="o">=</span><span class="s">&quot;big bear&quot;</span><span class="p">))</span>
<span class="c1">#&gt; $`_index`</span>
<span class="c1">#&gt; [1] &quot;animals&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_type`</span>
<span class="c1">#&gt; [1] &quot;bears&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_id`</span>
<span class="c1">#&gt; [1] &quot;1&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_version`</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $created</span>
<span class="c1">#&gt; [1] TRUE</span>
docs_create<span class="p">(</span>index<span class="o">=</span><span class="s">&#39;animals&#39;</span><span class="p">,</span> type<span class="o">=</span><span class="s">&#39;lions&#39;</span><span class="p">,</span> id<span class="o">=</span><span class="m">1</span><span class="p">,</span> body<span class="o">=</span><span class="kt">list</span><span class="p">(</span>id<span class="o">=</span><span class="s">&quot;6789&quot;</span><span class="p">,</span> name<span class="o">=</span><span class="s">&quot;scary lion!&quot;</span><span class="p">))</span>
<span class="c1">#&gt; $`_index`</span>
<span class="c1">#&gt; [1] &quot;animals&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_type`</span>
<span class="c1">#&gt; [1] &quot;lions&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_id`</span>
<span class="c1">#&gt; [1] &quot;1&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_version`</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $created</span>
<span class="c1">#&gt; [1] TRUE</span>
</code></pre></div>
<blockquote>
<p>The documents are there now, get one</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">docs_get<span class="p">(</span>index<span class="o">=</span><span class="s">&#39;animals&#39;</span><span class="p">,</span> type<span class="o">=</span><span class="s">&#39;bears&#39;</span><span class="p">,</span> id<span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="c1">#&gt; $`_index`</span>
<span class="c1">#&gt; [1] &quot;animals&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_type`</span>
<span class="c1">#&gt; [1] &quot;bears&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_id`</span>
<span class="c1">#&gt; [1] &quot;1&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_version`</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $found</span>
<span class="c1">#&gt; [1] TRUE</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_source`</span>
<span class="c1">#&gt; $`_source`$id</span>
<span class="c1">#&gt; $`_source`$id[[1]]</span>
<span class="c1">#&gt; [1] &quot;12345&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_source`$name</span>
<span class="c1">#&gt; $`_source`$name[[1]]</span>
<span class="c1">#&gt; [1] &quot;big bear&quot;</span>
</code></pre></div>
<blockquote>
<p>Get multiple documents at once</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">docs_mget<span class="p">(</span>index_type_id<span class="o">=</span><span class="kt">list</span><span class="p">(</span><span class="kt">c</span><span class="p">(</span><span class="s">&quot;animals&quot;</span><span class="p">,</span><span class="s">&quot;bears&quot;</span><span class="p">,</span><span class="m">1</span><span class="p">),</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;animals&quot;</span><span class="p">,</span><span class="s">&quot;lions&quot;</span><span class="p">,</span><span class="m">1</span><span class="p">)))</span>
<span class="c1">#&gt; $docs</span>
<span class="c1">#&gt; $docs[[1]]</span>
<span class="c1">#&gt; $docs[[1]]$`_index`</span>
<span class="c1">#&gt; [1] &quot;animals&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[1]]$`_type`</span>
<span class="c1">#&gt; [1] &quot;bears&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[1]]$`_id`</span>
<span class="c1">#&gt; [1] &quot;1&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[1]]$`_version`</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[1]]$found</span>
<span class="c1">#&gt; [1] TRUE</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[1]]$`_source`</span>
<span class="c1">#&gt; $docs[[1]]$`_source`$id</span>
<span class="c1">#&gt; $docs[[1]]$`_source`$id[[1]]</span>
<span class="c1">#&gt; [1] &quot;12345&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[1]]$`_source`$name</span>
<span class="c1">#&gt; $docs[[1]]$`_source`$name[[1]]</span>
<span class="c1">#&gt; [1] &quot;big bear&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[2]]</span>
<span class="c1">#&gt; $docs[[2]]$`_index`</span>
<span class="c1">#&gt; [1] &quot;animals&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[2]]$`_type`</span>
<span class="c1">#&gt; [1] &quot;lions&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[2]]$`_id`</span>
<span class="c1">#&gt; [1] &quot;1&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[2]]$`_version`</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[2]]$found</span>
<span class="c1">#&gt; [1] TRUE</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[2]]$`_source`</span>
<span class="c1">#&gt; $docs[[2]]$`_source`$id</span>
<span class="c1">#&gt; $docs[[2]]$`_source`$id[[1]]</span>
<span class="c1">#&gt; [1] &quot;6789&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $docs[[2]]$`_source`$name</span>
<span class="c1">#&gt; $docs[[2]]$`_source`$name[[1]]</span>
<span class="c1">#&gt; [1] &quot;scary lion!&quot;</span>
</code></pre></div>
<h2>Search</h2>

<h3>First, get data</h3>

<blockquote>
<p>Elasticsearch has a bulk load API to load data in fast. The format is weird - it&#39;s sort of JSON. I include a few data sets in <code>elastic</code> so it&#39;s easy to get up and running, and so when you run examples in this package they&#39;ll actually run the same way (hopefully).</p>

<p>Shakespeare data</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">shakespeare <span class="o">&lt;-</span> <span class="kp">system.file</span><span class="p">(</span><span class="s">&quot;examples&quot;</span><span class="p">,</span> <span class="s">&quot;shakespeare_data.json&quot;</span><span class="p">,</span> package <span class="o">=</span> <span class="s">&quot;elastic&quot;</span><span class="p">)</span>
</code></pre></div>
<blockquote>
<p>Then load the data into Elasticsearch:</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">docs_bulk<span class="p">(</span>shakespeare<span class="p">)</span>
</code></pre></div>
<h3>Search the data</h3>

<blockquote>
<p>Search the <code>shakespeare</code> index and only return 1 result</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">Search<span class="p">(</span>index <span class="o">=</span> <span class="s">&quot;shakespeare&quot;</span><span class="p">,</span> size <span class="o">=</span> <span class="m">1</span><span class="p">)</span><span class="o">$</span>hits<span class="o">$</span>hits
<span class="c1">#&gt; [[1]]</span>
<span class="c1">#&gt; [[1]]$`_index`</span>
<span class="c1">#&gt; [1] &quot;shakespeare&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_type`</span>
<span class="c1">#&gt; [1] &quot;line&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_id`</span>
<span class="c1">#&gt; [1] &quot;4&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_version`</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_score`</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_source`</span>
<span class="c1">#&gt; [[1]]$`_source`$line_id</span>
<span class="c1">#&gt; [1] 5</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_source`$play_name</span>
<span class="c1">#&gt; [1] &quot;Henry IV&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_source`$speech_number</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_source`$line_number</span>
<span class="c1">#&gt; [1] &quot;1.1.2&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_source`$speaker</span>
<span class="c1">#&gt; [1] &quot;KING HENRY IV&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_source`$text_entry</span>
<span class="c1">#&gt; [1] &quot;Find we a time for frighted peace to pant,&quot;</span>
</code></pre></div>
<blockquote>
<p>Search the <code>shakespeare</code> index, and the <code>scene</code> document type, and query for <em>york</em></p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">Search<span class="p">(</span>index<span class="o">=</span><span class="s">&quot;shakespeare&quot;</span><span class="p">,</span> type<span class="o">=</span><span class="s">&quot;scene&quot;</span><span class="p">,</span>
       q<span class="o">=</span><span class="s">&quot;york&quot;</span><span class="p">,</span> size<span class="o">=</span><span class="m">2</span><span class="p">,</span> fields <span class="o">=</span> <span class="s">&#39;speaker&#39;</span><span class="p">)</span><span class="o">$</span>hits<span class="o">$</span>hits
<span class="c1">#&gt; [[1]]</span>
<span class="c1">#&gt; [[1]]$`_index`</span>
<span class="c1">#&gt; [1] &quot;shakespeare&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_type`</span>
<span class="c1">#&gt; [1] &quot;scene&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_id`</span>
<span class="c1">#&gt; [1] &quot;2588&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_version`</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$`_score`</span>
<span class="c1">#&gt; [1] 1.377465</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[1]]$fields</span>
<span class="c1">#&gt; [[1]]$fields$speaker</span>
<span class="c1">#&gt; [[1]]$fields$speaker[[1]]</span>
<span class="c1">#&gt; [1] &quot;SIR WALTER BLUNT&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[2]]</span>
<span class="c1">#&gt; [[2]]$`_index`</span>
<span class="c1">#&gt; [1] &quot;shakespeare&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[2]]$`_type`</span>
<span class="c1">#&gt; [1] &quot;scene&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[2]]$`_id`</span>
<span class="c1">#&gt; [1] &quot;2634&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[2]]$`_version`</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[2]]$`_score`</span>
<span class="c1">#&gt; [1] 1.377465</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; [[2]]$fields</span>
<span class="c1">#&gt; [[2]]$fields$speaker</span>
<span class="c1">#&gt; [[2]]$fields$speaker[[1]]</span>
<span class="c1">#&gt; [1] &quot;ARCHBISHOP OF YORK&quot;</span>
</code></pre></div>
<blockquote>
<p>Fuzzy search</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">Search<span class="p">(</span>index<span class="o">=</span><span class="s">&quot;shakespeare&quot;</span><span class="p">,</span> q<span class="o">=</span><span class="s">&quot;text_entry:ma~&quot;</span><span class="p">)</span><span class="o">$</span>hits<span class="o">$</span>total
<span class="c1">#&gt; [1] 893</span>
</code></pre></div>
<blockquote>
<p>Ranges, here where line_id value is between 10 and 20</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">Search<span class="p">(</span>index<span class="o">=</span><span class="s">&quot;shakespeare&quot;</span><span class="p">,</span> q<span class="o">=</span><span class="s">&quot;line_id:[10 TO 20]&quot;</span><span class="p">)</span><span class="o">$</span>hits<span class="o">$</span>total
<span class="c1">#&gt; [1] 11</span>
</code></pre></div>
<blockquote>
<p>Give explanation of search in result</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">Search<span class="p">(</span>index<span class="o">=</span><span class="s">&quot;shakespeare&quot;</span><span class="p">,</span> size<span class="o">=</span><span class="m">1</span><span class="p">,</span> explain<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>
<span class="c1">#&gt; $took</span>
<span class="c1">#&gt; [1] 2</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $timed_out</span>
<span class="c1">#&gt; [1] FALSE</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_shards`</span>
<span class="c1">#&gt; $`_shards`$total</span>
<span class="c1">#&gt; [1] 5</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_shards`$successful</span>
<span class="c1">#&gt; [1] 5</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $`_shards`$failed</span>
<span class="c1">#&gt; [1] 0</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits</span>
<span class="c1">#&gt; $hits$total</span>
<span class="c1">#&gt; [1] 5000</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$max_score</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits</span>
<span class="c1">#&gt; $hits$hits[[1]]</span>
<span class="c1">#&gt; $hits$hits[[1]]$`_shard`</span>
<span class="c1">#&gt; [1] 0</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_node`</span>
<span class="c1">#&gt; [1] &quot;sqJtMy9eSB6eEm7GTQ1uiA&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_index`</span>
<span class="c1">#&gt; [1] &quot;shakespeare&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_type`</span>
<span class="c1">#&gt; [1] &quot;line&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_id`</span>
<span class="c1">#&gt; [1] &quot;4&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_version`</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_score`</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_source`</span>
<span class="c1">#&gt; $hits$hits[[1]]$`_source`$line_id</span>
<span class="c1">#&gt; [1] 5</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_source`$play_name</span>
<span class="c1">#&gt; [1] &quot;Henry IV&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_source`$speech_number</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_source`$line_number</span>
<span class="c1">#&gt; [1] &quot;1.1.2&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_source`$speaker</span>
<span class="c1">#&gt; [1] &quot;KING HENRY IV&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_source`$text_entry</span>
<span class="c1">#&gt; [1] &quot;Find we a time for frighted peace to pant,&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_explanation`</span>
<span class="c1">#&gt; $hits$hits[[1]]$`_explanation`$value</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_explanation`$description</span>
<span class="c1">#&gt; [1] &quot;ConstantScore(*:*), product of:&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_explanation`$details</span>
<span class="c1">#&gt; $hits$hits[[1]]$`_explanation`$details[[1]]</span>
<span class="c1">#&gt; $hits$hits[[1]]$`_explanation`$details[[1]]$value</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_explanation`$details[[1]]$description</span>
<span class="c1">#&gt; [1] &quot;boost&quot;</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_explanation`$details[[2]]</span>
<span class="c1">#&gt; $hits$hits[[1]]$`_explanation`$details[[2]]$value</span>
<span class="c1">#&gt; [1] 1</span>
<span class="c1">#&gt; </span>
<span class="c1">#&gt; $hits$hits[[1]]$`_explanation`$details[[2]]$description</span>
<span class="c1">#&gt; [1] &quot;queryNorm&quot;</span>
</code></pre></div>
<blockquote>
<p>Aggregations</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">aggs <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">(</span>aggs <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>stats <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>terms <span class="o">=</span> <span class="kt">list</span><span class="p">(</span>field <span class="o">=</span> <span class="s">&quot;text_entry&quot;</span><span class="p">))))</span>
res <span class="o">&lt;-</span> Search<span class="p">(</span>index<span class="o">=</span><span class="s">&quot;shakespeare&quot;</span><span class="p">,</span> body<span class="o">=</span>aggs<span class="p">)</span>
plyr<span class="o">::</span>ldply<span class="p">(</span>res<span class="o">$</span>aggregations<span class="o">$</span>stats<span class="o">$</span>buckets<span class="p">,</span> <span class="kt">data.frame</span><span class="p">)</span>
<span class="c1">#&gt;     key doc_count</span>
<span class="c1">#&gt; 1   and      1192</span>
<span class="c1">#&gt; 2   the      1192</span>
<span class="c1">#&gt; 3    of       903</span>
<span class="c1">#&gt; 4     i       837</span>
<span class="c1">#&gt; 5    to       714</span>
<span class="c1">#&gt; 6     a       659</span>
<span class="c1">#&gt; 7    in       543</span>
<span class="c1">#&gt; 8    my       482</span>
<span class="c1">#&gt; 9  that       387</span>
<span class="c1">#&gt; 10  you       386</span>
</code></pre></div>
<blockquote>
<p>You can also pass in a json query with newlines, much easier to read</p>
</blockquote>
<div class="highlight"><pre><code class="language-r" data-lang="r">aggs <span class="o">&lt;-</span> <span class="s">&#39;{</span>
<span class="s">    &quot;aggs&quot;: {</span>
<span class="s">        &quot;stats&quot; : {</span>
<span class="s">            &quot;terms&quot; : {</span>
<span class="s">                &quot;field&quot; : &quot;text_entry&quot;</span>
<span class="s">            }</span>
<span class="s">        }</span>
<span class="s">    }</span>
<span class="s">}&#39;</span>
Search<span class="p">(</span>index<span class="o">=</span><span class="s">&quot;shakespeare&quot;</span><span class="p">,</span> body<span class="o">=</span>aggs<span class="p">)</span>
</code></pre></div>
<h2>More info</h2>

<ul>
<li>Look out for <code>elasticdsl</code> package, which will make it much easier to perform queries
against Elaticsearch</li>
</ul>

<h2>end</h2>

<blockquote>
<p>That&#39;s it! Thanks for watching...</p>
</blockquote>

</article>


      <footer>
        <p>
          This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/deed.en_US">Creative Commons Attribution-NonCommercial 4.0 International License</a>.
        </p>
      </footer>
    </div>

    <!-- scripts -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/screencasts/public/js/jquery.fitvids.js"></script>
    <script>
      $(document).ready(function(){
        $("article").fitVids();
      });
    </script>
  </body>
  <footer>
  <script type="text/javascript">
    var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '54ef85ebde2e2660bf00e187');
      t.src = '//secure.gaug.es/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
  </script>
</footer>

</html>
